<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Family Feud - Enhanced Edition</title>
<style>
  /* ‚îÄ‚îÄ‚îÄ RESET & BASE ‚îÄ‚îÄ‚îÄ */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Segoe UI', 'Arial Black', sans-serif;
    background: #0a1628;
    color: #fff;
    height: 100vh;
    overflow-y: auto;
    user-select: none;
  }

  /* ‚îÄ‚îÄ‚îÄ STARFIELD BACKGROUND ‚îÄ‚îÄ‚îÄ */
  .bg-dots {
    position: fixed; inset: 0; z-index: 0;
    background:
      radial-gradient(circle, rgba(60,120,220,.15) 1px, transparent 1px),
      radial-gradient(circle, rgba(80,140,255,.1) 1px, transparent 1px);
    background-size: 40px 40px, 70px 70px;
    background-position: 0 0, 35px 35px;
    pointer-events: none;
  }

  /* ‚îÄ‚îÄ‚îÄ MAIN LAYOUT ‚îÄ‚îÄ‚îÄ */
  .game-wrap {
    position: relative; z-index: 1;
    width: 100%; min-height: 100vh;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    gap: 16px; padding: 36px 60px;
  }

  /* ‚îÄ‚îÄ‚îÄ OVERLAYS ‚îÄ‚îÄ‚îÄ */
  .overlay {
    position: fixed; inset: 0; z-index: 100;
    background: rgba(10,22,40,.95);
    backdrop-filter: blur(6px);
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    gap: 24px;
    padding: 40px;
  }
  .overlay h1 {
    font-size: 3.5rem;
    font-weight: 900;
    background: linear-gradient(135deg, #f0a500, #ff6b35);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    text-shadow: 0 4px 20px rgba(240,165,0,.3);
    letter-spacing: 2px;
  }
  .overlay h2 {
    font-size: 1.3rem;
    font-weight: 600;
    color: #8ab4f8;
    letter-spacing: 1px;
  }
  .overlay-btn {
    background: linear-gradient(135deg, #1a56db, #2266ec);
    color: #fff;
    border: none;
    border-radius: 12px;
    font-size: 1.2rem;
    font-weight: 700;
    padding: 16px 48px;
    cursor: pointer;
    transition: all .3s;
    text-transform: uppercase;
    letter-spacing: 2px;
    box-shadow: 0 6px 20px rgba(26,86,219,.4);
  }
  .overlay-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(26,86,219,.6);
  }
  .overlay-btn:active { transform: translateY(0); }

  /* ‚îÄ‚îÄ‚îÄ SETTINGS PANEL ‚îÄ‚îÄ‚îÄ */
  .settings-panel {
    background: linear-gradient(180deg, #1a2744 0%, #0f1e3a 100%);
    border: 2px solid #2a4a8a;
    border-radius: 14px;
    padding: 24px 32px;
    max-width: 600px;
    width: 90%;
  }
  .settings-section {
    margin-bottom: 20px;
  }
  .settings-section:last-child { margin-bottom: 0; }
  .settings-section h3 {
    font-size: 1rem;
    font-weight: 700;
    color: #8ab4f8;
    margin-bottom: 12px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .setting-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
  }
  .setting-label {
    font-size: 0.95rem;
    color: #fff;
  }
  .setting-input {
    background: #0f1e3a;
    border: 1.5px solid #2a4a8a;
    border-radius: 6px;
    color: #fff;
    padding: 6px 12px;
    font-size: 0.9rem;
    min-width: 80px;
    text-align: center;
  }
  .setting-input:focus {
    outline: none;
    border-color: #4a8aff;
  }
  select.setting-input {
    cursor: pointer;
    min-width: 200px;
  }

  /* ‚îÄ‚îÄ‚îÄ FILE SELECTOR ‚îÄ‚îÄ‚îÄ */
  .file-selector {
    display: flex;
    flex-direction: column;
    gap: 12px;
    width: 100%;
  }
  .file-option {
    background: rgba(30,58,110,.5);
    border: 2px solid #2a4a8a;
    border-radius: 8px;
    padding: 12px 16px;
    cursor: pointer;
    transition: all .3s;
    display: flex;
    align-items: center;
    gap: 12px;
  }
  .file-option:hover {
    border-color: #4a8aff;
    background: rgba(30,58,110,.7);
  }
  .file-option.selected {
    border-color: #f0a500;
    background: rgba(240,165,0,.15);
  }
  .file-option input[type="radio"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }
  .file-option-label {
    flex: 1;
    font-size: 1rem;
    font-weight: 600;
  }
  .file-upload-zone {
    border: 2px dashed #2a4a8a;
    border-radius: 8px;
    padding: 20px;
    text-align: center;
    cursor: pointer;
    transition: all .3s;
  }
  .file-upload-zone:hover {
    border-color: #4a8aff;
    background: rgba(30,58,110,.3);
  }
  .file-upload-zone.dragover {
    border-color: #f0a500;
    background: rgba(240,165,0,.15);
  }

  /* ‚îÄ‚îÄ‚îÄ ROUND INDICATOR ‚îÄ‚îÄ‚îÄ */
  .round-indicator {
    background: linear-gradient(135deg, #1a56db, #2266ec);
    color: #fff;
    padding: 8px 24px;
    border-radius: 20px;
    font-size: .9rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    box-shadow: 0 4px 12px rgba(26,86,219,.3);
  }

  /* ‚îÄ‚îÄ‚îÄ QUESTION BANNER ‚îÄ‚îÄ‚îÄ */
  .question-box {
    background: linear-gradient(180deg, #1a2744 0%, #0f1e3a 100%);
    border: 2px solid #2a4a8a;
    border-radius: 14px;
    padding: 18px 32px;
    text-align: center;
    width: 90%; max-width: 860px;
    box-shadow: 0 4px 24px rgba(0,0,0,.5);
  }
  .question-box h2 {
    font-size: 1.55rem;
    font-weight: 700;
    color: #fff;
    letter-spacing: .5px;
    text-shadow: 0 2px 6px rgba(0,0,0,.6);
  }

  /* ‚îÄ‚îÄ‚îÄ TIMER ‚îÄ‚îÄ‚îÄ */
  .timer-wrap {
    display: flex; justify-content: center;
  }
  .timer-box {
    background: #1a56db;
    color: #fff;
    font-size: 1.7rem;
    font-weight: 800;
    width: 86px; height: 46px;
    border-radius: 8px;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 3px 12px rgba(0,0,0,.5);
    transition: background .3s;
    letter-spacing: 2px;
  }
  .timer-box.warning { background: #e67e22; }
  .timer-box.danger  { background: #c0392b; animation: pulse .5s infinite alternate; }
  @keyframes pulse { to { transform: scale(1.07); } }

  /* ‚îÄ‚îÄ‚îÄ BOARD RING ‚îÄ‚îÄ‚îÄ */
  .board-ring {
    position: relative;
    width: 92%; max-width: 880px;
    padding: 28px 28px 24px;
    background: linear-gradient(180deg, #162040 0%, #0d1733 100%);
    border-radius: 50px / 38px;
    overflow: visible;
    box-shadow:
      0 0 0 5px #1a1a2e,
      0 0 0 9px #c07000,
      0 0 0 13px #f0a500,
      0 0 0 16px #c07000,
      0 0 0 20px #0a0f1e,
      0 0 40px rgba(240,165,0,.3);
  }

  /* ‚îÄ‚îÄ‚îÄ FAMILY FEUD SIDE LOGOS ‚îÄ‚îÄ‚îÄ */
  .side-logo {
    position: absolute; top: 50%; transform: translateY(-50%);
    width: 100px; height: 56px;
    background: linear-gradient(135deg, #1a56db, #0d3a8e);
    border-radius: 12px 0 0 12px;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 3px 12px rgba(0,0,0,.5);
    font-size: .82rem; font-weight: 900;
    color: #f0c040; text-shadow: 1px 1px 2px rgba(0,0,0,.7);
    letter-spacing: 1px; text-transform: uppercase;
    line-height: 1.1; text-align: center;
    z-index: 2;
  }
  .side-logo.left  { left: -96px; border-radius: 12px 0 0 12px; }
  .side-logo.right { right: -96px; border-radius: 0 12px 12px 0; }

  /* ‚îÄ‚îÄ‚îÄ ANSWER GRID ‚îÄ‚îÄ‚îÄ */
  .answer-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 12px 16px;
    width: 100%; max-width: 700px;
    margin: 0 auto;
  }
  .answer-slot {
    background: linear-gradient(180deg, #1e3a6e 0%, #162a52 100%);
    border: 1.5px solid #2a4a8a;
    border-radius: 8px;
    height: 58px;
    display: flex; align-items: center;
    padding: 0 16px; gap: 10px;
    position: relative;
    overflow: hidden;
    transition: background .3s, border-color .3s, box-shadow .3s;
  }
  .answer-slot .slot-num {
    background: #1a56db;
    color: #fff;
    width: 28px; height: 28px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-weight: 800; font-size: .88rem;
    flex-shrink: 0;
    box-shadow: 0 2px 6px rgba(0,0,0,.4);
  }
  .answer-slot .slot-text {
    font-size: 1rem; font-weight: 600;
    color: transparent;
    transition: color .2s;
    text-transform: uppercase; letter-spacing: 1px;
  }
  .answer-slot .slot-points {
    position: absolute; right: 14px;
    font-size: .9rem; font-weight: 800;
    color: transparent;
    transition: color .2s;
  }
  .answer-slot.revealed {
    background: linear-gradient(180deg, #1a56db 0%, #1040a0 100%);
    border-color: #3a7aff;
    box-shadow: 0 0 14px rgba(26,86,219,.5), inset 0 1px 0 rgba(255,255,255,.15);
  }
  .answer-slot.revealed .slot-text { color: #fff; }
  .answer-slot.revealed .slot-points { color: #f0c040; }

  /* ‚îÄ‚îÄ‚îÄ SCORES ROW ‚îÄ‚îÄ‚îÄ */
  .scores-row {
    display: flex; justify-content: space-between;
    width: 92%; max-width: 880px;
    margin-top: 8px;
  }
  .team-score {
    background: linear-gradient(180deg, #1a2744, #0f1e3a);
    border: 1.5px solid #2a4a8a;
    border-radius: 10px;
    padding: 6px 22px;
    display: flex; align-items: center; gap: 10px;
    cursor: pointer;
    transition: border-color .2s, box-shadow .2s;
  }
  .team-score:hover { border-color: #4a8aff; }
  .team-score.active {
    border-color: #f0a500;
    box-shadow: 0 0 12px rgba(240,165,0,.4);
  }
  .team-score .team-label {
    font-size: .85rem; font-weight: 700; color: #8ab4f8; text-transform: uppercase; letter-spacing: 1px;
  }
  .team-score .team-name-input {
    background: transparent; border: none; border-bottom: 1px solid #2a4a8a;
    color: #fff; font-size: .85rem; font-weight: 700; width: 80px;
    outline: none; text-align: center;
  }
  .team-score .team-name-input:focus { border-bottom-color: #4a8aff; }
  .team-score .score-val {
    font-size: 1.4rem; font-weight: 800; color: #fff;
    min-width: 44px; text-align: right;
  }

  /* ‚îÄ‚îÄ‚îÄ STRIKES ‚îÄ‚îÄ‚îÄ */
  .strikes-row {
    display: flex; gap: 10px; justify-content: center;
  }
  .strike {
    width: 34px; height: 34px;
    border: 2.5px solid #2a4a8a;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 1.3rem; font-weight: 900;
    color: transparent;
    background: #0f1e3a;
    transition: all .3s;
  }
  .strike.active {
    border-color: #c0392b;
    color: #e74c3c;
    background: #2a0a0a;
    box-shadow: 0 0 12px rgba(231,76,60,.5);
    animation: strikeIn .3s ease;
  }
  @keyframes strikeIn { from { transform: scale(1.4); } to { transform: scale(1); } }

  /* ‚îÄ‚îÄ‚îÄ INPUT AREA ‚îÄ‚îÄ‚îÄ */
  .input-area {
    display: flex; gap: 8px; align-items: center;
    width: 92%; max-width: 880px;
  }
  .btn {
    background: #1a56db;
    color: #fff;
    border: none;
    border-radius: 8px;
    font-size: .95rem; font-weight: 700;
    padding: 0 18px; height: 46px;
    cursor: pointer;
    transition: background .2s, transform .1s;
    text-transform: uppercase; letter-spacing: 1px;
    box-shadow: 0 3px 10px rgba(0,0,0,.4);
  }
  .btn:hover { background: #2266ec; }
  .btn:active { transform: scale(.96); }
  .btn.skip { min-width: 80px; }
  .btn.submit { min-width: 52px; font-size: 1.2rem; }
  .answer-input {
    flex: 1;
    background: #fff;
    border: none;
    border-radius: 8px;
    height: 46px;
    padding: 0 16px;
    font-size: 1rem;
    font-weight: 600;
  }
  .answer-input:focus { outline: 2px solid #1a56db; }

  /* ‚îÄ‚îÄ‚îÄ STATS OVERLAY ‚îÄ‚îÄ‚îÄ */
  .stats-overlay {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(26, 39, 68, 0.95);
    border: 2px solid #2a4a8a;
    border-radius: 12px;
    padding: 16px 20px;
    min-width: 240px;
    z-index: 50;
    backdrop-filter: blur(8px);
  }
  .stats-title {
    font-size: 0.9rem;
    font-weight: 700;
    color: #8ab4f8;
    margin-bottom: 10px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .stat-row {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
    font-size: 0.85rem;
  }
  .stat-label { color: #b0c4de; }
  .stat-value { 
    color: #fff;
    font-weight: 700;
  }

  /* ‚îÄ‚îÄ‚îÄ CONTROL PANEL ‚îÄ‚îÄ‚îÄ */
  .control-panel {
    position: fixed;
    bottom: 20px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: 8px;
    z-index: 50;
  }
  .control-btn {
    background: rgba(26, 39, 68, 0.95);
    border: 2px solid #2a4a8a;
    border-radius: 50%;
    width: 48px;
    height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all .3s;
    font-size: 1.3rem;
  }
  .control-btn:hover {
    border-color: #4a8aff;
    transform: scale(1.1);
  }
  .control-btn.active {
    background: rgba(240, 165, 0, 0.2);
    border-color: #f0a500;
  }

  /* ‚îÄ‚îÄ‚îÄ VOLUME SLIDER ‚îÄ‚îÄ‚îÄ */
  .volume-control {
    position: fixed;
    bottom: 180px;
    right: 20px;
    background: rgba(26, 39, 68, 0.95);
    border: 2px solid #2a4a8a;
    border-radius: 12px;
    padding: 16px 12px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    z-index: 50;
  }
  .volume-slider {
    -webkit-appearance: slider-vertical;
    width: 8px;
    height: 120px;
    background: #2a4a8a;
    border-radius: 4px;
    outline: none;
  }
  .volume-label {
    font-size: 0.75rem;
    color: #8ab4f8;
    font-weight: 700;
  }

  /* ‚îÄ‚îÄ‚îÄ FINAL ROUND STYLES ‚îÄ‚îÄ‚îÄ */
  .final-wrap {
    width: 92%; max-width: 880px;
    display: flex; flex-direction: column; gap: 20px;
  }
  .final-header {
    background: linear-gradient(135deg, #1a56db, #2266ec);
    border-radius: 14px;
    padding: 20px;
    text-align: center;
  }
  .final-header h2 {
    font-size: 2rem;
    font-weight: 900;
    color: #fff;
    margin-bottom: 8px;
  }
  .final-header p {
    font-size: 1rem;
    color: #b0d4ff;
  }
  .final-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 12px;
  }
  .final-cell {
    background: linear-gradient(180deg, #1e3a6e 0%, #162a52 100%);
    border: 2px solid #2a4a8a;
    border-radius: 8px;
    padding: 16px 8px;
    text-align: center;
    font-size: 1.2rem;
    font-weight: 800;
    color: #8ab4f8;
    transition: all .3s;
  }
  .final-cell.active {
    border-color: #f0a500;
    box-shadow: 0 0 16px rgba(240,165,0,.5);
  }
  .final-cell.done {
    background: rgba(39,174,96,.2);
    border-color: #27ae60;
  }
  .final-echo {
    background: rgba(30,58,110,.5);
    border: 2px solid #2a4a8a;
    border-radius: 10px;
    padding: 12px;
    text-align: center;
    font-size: 1.1rem;
    font-weight: 600;
    color: #8ab4f8;
    min-height: 48px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  /* ‚îÄ‚îÄ‚îÄ REVEAL OVERLAY ‚îÄ‚îÄ‚îÄ */
  .reveal-overlay {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 16px;
    width: 92%;
    max-width: 720px;
  }
  .reveal-rows {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 12px;
  }
  .reveal-row {
    background: linear-gradient(180deg, #1e3a6e 0%, #162a52 100%);
    border: 2px solid #2a4a8a;
    border-radius: 10px;
    padding: 14px 18px;
    display: flex;
    align-items: center;
    gap: 12px;
    opacity: 0.3;
    transition: all .4s;
  }
  .reveal-row .rr-num {
    background: #2a4a8a;
    color: #fff;
    width: 32px; height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 800;
    font-size: .95rem;
    flex-shrink: 0;
  }
  .reveal-row .rr-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .reveal-row .rr-question {
    font-size: .85rem;
    font-weight: 600;
    color: #8ab4f8;
  }
  .reveal-row .rr-answers {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }
  .reveal-row .rr-guess {
    font-size: .88rem;
    color: #b0c4de;
  }
  .reveal-row .rr-correct {
    font-size: 1rem;
    font-weight: 700;
    color: transparent;
    text-transform: uppercase;
    letter-spacing: .5px;
    transition: color .2s;
  }
  .reveal-row .rr-pts {
    font-size: .88rem;
    font-weight: 800;
    color: transparent;
    transition: color .2s;
  }
  .reveal-row.active { opacity: 1; }
  .reveal-row.hit {
    opacity: 1;
    background: linear-gradient(180deg, #1a56db, #1040a0);
    border-color: #3a7aff;
    box-shadow: 0 0 18px rgba(26,86,219,.5);
  }
  .reveal-row.hit .rr-num { background: #27ae60; }
  .reveal-row.hit .rr-question { color: #a8c8ff; }
  .reveal-row.hit .rr-guess { color: #a8d8a8; }
  .reveal-row.hit .rr-correct { color: #fff; }
  .reveal-row.hit .rr-pts { color: #f0c040; }
  .reveal-row.miss {
    opacity: 1;
    border-color: #4a4a6a;
  }
  .reveal-row.miss .rr-correct { color: #fff; }
  .reveal-row.miss .rr-pts { color: #6a6a8a; }

  /* ‚îÄ‚îÄ‚îÄ NUMBER ONE CELEBRATION ‚îÄ‚îÄ‚îÄ */
  .number-one-flash {
    position: fixed;
    inset: 0;
    z-index: 110;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    animation: n1fade 1.6s ease forwards;
  }
  .number-one-flash .n1-burst {
    position: absolute;
    inset: 0;
    background: radial-gradient(circle at center, rgba(240,165,0,.45) 0%, transparent 70%);
    animation: n1burst .5s ease forwards;
  }
  .number-one-flash .n1-text {
    position: relative;
    z-index: 1;
    font-size: 5rem;
    font-weight: 900;
    color: #f0a500;
    text-shadow: 0 0 40px rgba(240,165,0,.8), 0 0 80px rgba(240,165,0,.4);
    text-transform: uppercase;
    letter-spacing: 6px;
    animation: n1pop .4s cubic-bezier(.17,.67,.16,1.51) forwards;
  }
  @keyframes n1burst { from { transform: scale(0); opacity: 1; } to { transform: scale(1.6); opacity: 0; } }
  @keyframes n1pop { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
  @keyframes n1fade { 0%,50% { opacity: 1; } 100% { opacity: 0; } }

  /* ‚îÄ‚îÄ‚îÄ REVEAL TOTAL BAR ‚îÄ‚îÄ‚îÄ */
  .reveal-total-bar {
    width: 100%;
    max-width: 680px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 4px;
  }
  .reveal-total-bar .rt-label {
    font-size: .85rem;
    font-weight: 700;
    color: #8ab4f8;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .reveal-total-bar .rt-val {
    font-size: 1.6rem;
    font-weight: 900;
    color: #fff;
  }
  .reveal-total-bar .rt-val.positive { color: #f0a500; }

  /* ‚îÄ‚îÄ‚îÄ FLASH EFFECTS ‚îÄ‚îÄ‚îÄ */
  .wrong-flash {
    position: fixed;
    inset: 0;
    z-index: 50;
    background: rgba(192,57,43,.25);
    pointer-events: none;
    animation: wrongFlash .4s ease forwards;
  }
  @keyframes wrongFlash { to { opacity: 0; } }

  .correct-flash {
    position: fixed;
    inset: 0;
    z-index: 50;
    background: rgba(39,174,96,.2);
    pointer-events: none;
    animation: wrongFlash .35s ease forwards;
  }

  .big-x {
    position: fixed;
    inset: 0;
    z-index: 60;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
    animation: xFade .6s ease forwards;
  }
  .big-x span {
    font-size: 16rem;
    font-weight: 900;
    color: #e74c3c;
    text-shadow: 0 0 60px rgba(231,76,60,.7);
    animation: xIn .25s ease;
  }
  @keyframes xIn { from { transform: scale(0); opacity: 0; } to { transform: scale(1); opacity: 1; } }
  @keyframes xFade { 0% { opacity: 1; } 60% { opacity: 1; } 100% { opacity: 0; } }

  /* ‚îÄ‚îÄ‚îÄ GAME OVER SCORES ‚îÄ‚îÄ‚îÄ */
  .final-scores {
    display: flex;
    gap: 40px;
    margin-top: 8px;
  }
  .final-score-card {
    background: linear-gradient(180deg, #1a2744, #0f1e3a);
    border: 2px solid #2a4a8a;
    border-radius: 14px;
    padding: 18px 30px;
    text-align: center;
    min-width: 140px;
  }
  .final-score-card.winner {
    border-color: #f0a500;
    box-shadow: 0 0 20px rgba(240,165,0,.4);
  }
  .final-score-card .fs-name {
    font-size: 1rem;
    font-weight: 700;
    color: #8ab4f8;
    margin-bottom: 4px;
  }
  .final-score-card .fs-val {
    font-size: 2.2rem;
    font-weight: 900;
    color: #fff;
  }
  .final-score-card.winner .fs-val { color: #f0a500; }
  .final-score-card .fs-crown { font-size: 1.5rem; }

  /* ‚îÄ‚îÄ‚îÄ REVEAL PILLS ‚îÄ‚îÄ‚îÄ */
  .reveal-pill {
    display: flex;
    align-items: center;
    gap: 8px;
    background: rgba(30,58,110,.7);
    border: 1.5px solid #2a4a8a;
    border-radius: 8px;
    padding: 7px 12px 7px 8px;
    min-width: 140px;
    transition: border-color .2s;
  }
  .reveal-pill.earned {
    border-color: #27ae60;
    background: rgba(39,174,96,.18);
  }
  .reveal-pill.missed {
    border-color: #4a4a6a;
    background: rgba(30,30,60,.6);
    opacity: .7;
  }
  .reveal-pill .reveal-num {
    background: #1a56db;
    color: #fff;
    width: 22px;
    height: 22px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: .75rem;
    font-weight: 800;
    flex-shrink: 0;
  }
  .reveal-pill.earned .reveal-num { background: #27ae60; }
  .reveal-pill .reveal-text {
    font-size: .88rem;
    font-weight: 600;
    color: #fff;
    text-transform: uppercase;
    letter-spacing: .5px;
    flex: 1;
  }
  .reveal-pill .reveal-pts {
    font-size: .82rem;
    font-weight: 800;
    color: #f0c040;
  }
  .reveal-pill.missed .reveal-pts { color: #6a6a8a; }

  /* ‚îÄ‚îÄ‚îÄ ANSWER COUNTER ‚îÄ‚îÄ‚îÄ */
  .answer-counter {
    background: rgba(26, 39, 68, 0.8);
    border: 2px solid #2a4a8a;
    border-radius: 8px;
    padding: 8px 16px;
    font-size: 0.85rem;
    font-weight: 700;
    color: #8ab4f8;
    text-align: center;
  }
  .answer-counter .counter-value {
    color: #f0a500;
    font-size: 1rem;
  }

  /* ‚îÄ‚îÄ‚îÄ SHOW ALL BUTTON ‚îÄ‚îÄ‚îÄ */
  .show-all-btn {
    background: rgba(240, 165, 0, 0.2);
    border: 2px solid #f0a500;
    border-radius: 8px;
    color: #f0a500;
    padding: 8px 20px;
    font-size: 0.9rem;
    font-weight: 700;
    cursor: pointer;
    transition: all .3s;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .show-all-btn:hover {
    background: rgba(240, 165, 0, 0.3);
    transform: translateY(-2px);
  }

  .hidden { display: none !important; }
</style>
</head>
<body>
<div class="bg-dots"></div>

<!-- ===================== START SCREEN ===================== -->
<div class="overlay" id="startScreen">
  <h1>Family Feud</h1>
  <h2>Enhanced Classroom Edition</h2>
  
  <div class="settings-panel">
    <div class="settings-section">
      <h3>üìÅ Select Question Set</h3>
      <div class="file-selector" id="fileSelector">
        <div class="file-option selected" onclick="selectQuestionFile('embedded')">
          <input type="radio" name="questionFile" value="embedded" checked>
          <span class="file-option-label">Built-in Questions (General Knowledge)</span>
        </div>
        <div class="file-upload-zone" id="uploadZone">
          <p>üì§ Drop JSON file here or click to upload</p>
          <input type="file" id="fileInput" accept=".json" style="display:none">
        </div>
      </div>
    </div>

    <div class="settings-section">
      <h3>‚öôÔ∏è Game Settings</h3>
      <div class="setting-row">
        <span class="setting-label">Number of Rounds:</span>
        <input type="number" class="setting-input" id="numRounds" min="1" max="5" value="3">
      </div>
      <div class="setting-row">
        <span class="setting-label">Questions per Round:</span>
        <input type="number" class="setting-input" id="questionsPerRound" min="1" max="6" value="2">
      </div>
      <div class="setting-row">
        <span class="setting-label">Time per Question (sec):</span>
        <input type="number" class="setting-input" id="timerDuration" min="15" max="120" value="45">
      </div>
      <div class="setting-row">
        <span class="setting-label">Strikes Allowed:</span>
        <input type="number" class="setting-input" id="maxStrikes" min="1" max="5" value="3">
      </div>
      <div class="setting-row">
        <span class="setting-label">Final Round Multiplier:</span>
        <input type="number" class="setting-input" id="finalMultiplier" min="1" max="5" value="2" step="0.5">
      </div>
      <div class="setting-row">
        <span class="setting-label">Answer Range (Min-Max):</span>
        <div style="display: flex; gap: 8px; align-items: center;">
          <input type="number" class="setting-input" id="minAnswers" min="2" max="8" value="2" style="width: 60px;">
          <span style="color: #8ab4f8;">‚Äì</span>
          <input type="number" class="setting-input" id="maxAnswers" min="2" max="8" value="8" style="width: 60px;">
        </div>
      </div>
    </div>
  </div>

  <button class="overlay-btn" onclick="startGame()">Start Game</button>
</div>

<!-- ===================== ROUND TRANSITION ===================== -->
<div class="overlay hidden" id="roundTransition">
  <h1 id="transitionTitle">Round 1</h1>
  <h2 id="transitionSub">Questions ‚Ä¢ Time limit</h2>
  <button class="overlay-btn" onclick="beginRound()">Go!</button>
</div>

<!-- ===================== NEXT QUESTION PAUSE ===================== -->
<div class="overlay hidden" id="nextQOverlay">
  <h1 id="nextQTitle">Question Complete</h1>
  <h2 id="nextQSub"></h2>
  <div id="revealedAnswers" style="
    display:flex; gap:10px; flex-wrap:wrap; justify-content:center;
    max-width:680px; margin: 4px 0 8px;
  "></div>
  <button class="overlay-btn" onclick="confirmNextQuestion()">Next Question</button>
</div>

<!-- ===================== MAIN GAME ===================== -->
<div class="game-wrap hidden" id="gameWrap">
  <div class="round-indicator" id="roundIndicator">Round 1 ‚Äî Question 1</div>

  <div class="question-box">
    <h2 id="questionText">...</h2>
  </div>

  <div class="timer-wrap">
    <div class="timer-box" id="timerBox">45</div>
  </div>

  <div class="answer-counter" id="answerCounter">
    Revealed: <span class="counter-value">0 / 0</span>
  </div>

  <div class="board-ring">
    <div class="side-logo left">FAMILY<br>FEUD</div>
    <div class="side-logo right">FAMILY<br>FEUD</div>
    <div class="answer-grid" id="answerGrid"></div>
  </div>

  <div class="scores-row">
    <div class="team-score active" id="team1Card" onclick="selectTeam(1)">
      <div>
        <div class="team-label">Team 1</div>
        <input type="text" class="team-name-input" id="team1Name" placeholder="Team A" maxlength="12">
      </div>
      <div class="score-val" id="team1Score">0</div>
    </div>
    <div class="team-score" id="team2Card" onclick="selectTeam(2)">
      <div>
        <div class="team-label">Team 2</div>
        <input type="text" class="team-name-input" id="team2Name" placeholder="Team B" maxlength="12">
      </div>
      <div class="score-val" id="team2Score">0</div>
    </div>
  </div>

  <div class="strikes-row" id="strikesRow"></div>

  <div class="input-area">
    <button class="btn skip" onclick="skipQuestion()">Pass</button>
    <input type="text" class="answer-input" id="answerInput" placeholder="Type your answer..." onkeypress="if(event.key==='Enter')submitAnswer()">
    <button class="btn submit" onclick="submitAnswer()">‚úì</button>
    <button class="btn show-all-btn" onclick="showAllAnswers()">Show All</button>
  </div>
</div>

<!-- ===================== FINAL ROUND ===================== -->
<div class="overlay hidden" id="finalWrap">
  <div class="final-header">
    <h2>üèÜ Final Round</h2>
    <p>Answer 5 rapid-fire questions ‚Äî any correct answer scores points!</p>
  </div>

  <div class="question-box">
    <h2 id="finalQuestionText">...</h2>
  </div>

  <div class="timer-wrap">
    <div class="timer-box" id="finalTimerBox">15</div>
  </div>

  <div class="final-grid" id="finalGrid">
    <div class="final-cell active" id="fcell0">1</div>
    <div class="final-cell" id="fcell1">2</div>
    <div class="final-cell" id="fcell2">3</div>
    <div class="final-cell" id="fcell3">4</div>
    <div class="final-cell" id="fcell4">5</div>
  </div>

  <div class="final-echo" id="finalEchoText">Waiting for answer...</div>

  <div class="input-area">
    <button class="btn skip" onclick="finalSkip()">Pass</button>
    <input type="text" class="answer-input" id="finalAnswerInput" placeholder="Quick! Type your answer..." onkeypress="if(event.key==='Enter')finalSubmit()">
    <button class="btn submit" onclick="finalSubmit()">‚úì</button>
  </div>
</div>

<!-- ===================== FINAL REVEAL ===================== -->
<div class="overlay hidden" id="finalRevealOverlay">
  <h1>Final Round Results</h1>
  <div class="reveal-overlay">
    <div class="reveal-rows" id="revealRows"></div>
    <div class="reveal-total-bar">
      <span class="rt-label">Total Earned:</span>
      <span class="rt-val" id="revealTotal">0</span>
    </div>
  </div>
  <button class="overlay-btn hidden" id="revealDoneBtn" onclick="revealDone()">Continue</button>
</div>

<!-- ===================== GAME OVER ===================== -->
<div class="overlay hidden" id="gameOverScreen">
  <h1>Game Over!</h1>
  <div class="final-scores" id="finalScores"></div>
  <div id="gameStats" style="margin-top: 20px; max-width: 400px;"></div>
  <button class="overlay-btn" onclick="restartGame()">Play Again</button>
</div>

<!-- ===================== STATS OVERLAY ===================== -->
<div class="stats-overlay hidden" id="statsOverlay">
  <div class="stats-title">üìä Game Stats</div>
  <div class="stat-row">
    <span class="stat-label">Questions Answered:</span>
    <span class="stat-value" id="statQuestionsAnswered">0</span>
  </div>
  <div class="stat-row">
    <span class="stat-label">Correct Answers:</span>
    <span class="stat-value" id="statCorrectAnswers">0</span>
  </div>
  <div class="stat-row">
    <span class="stat-label">Accuracy:</span>
    <span class="stat-value" id="statAccuracy">0%</span>
  </div>
  <div class="stat-row">
    <span class="stat-label">Avg Time/Answer:</span>
    <span class="stat-value" id="statAvgTime">0s</span>
  </div>
</div>

<!-- ===================== CONTROL PANEL ===================== -->
<div class="control-panel">
  <div class="control-btn" id="muteBtn" onclick="toggleMute()" title="Mute/Unmute">
    üîä
  </div>
  <div class="control-btn" id="statsBtn" onclick="toggleStats()" title="Toggle Stats">
    üìä
  </div>
</div>

<!-- ===================== VOLUME CONTROL ===================== -->
<div class="volume-control hidden" id="volumeControl">
  <span class="volume-label">VOL</span>
  <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70" orient="vertical" oninput="updateVolume(this.value)">
</div>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  GAME STATE & SETTINGS                                          ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let gamePhase = 'idle';
let scores = [0, 0];
let strikes = 0;
let activeTeam = 0;
let currentRound = 1;
let currentQIndex = 0;
let timerInterval = null;
let timeLeft = 45;
let currentQ = null;
let earnedSlots = new Set();
let pendingAdvance = null;

// Settings (loaded from UI)
let NUM_ROUNDS = 3;
let QUESTIONS_PER_ROUND = 2;
let TIMER_DURATION = 45;
let MAX_STRIKES = 3;
let FINAL_MULTIPLIER = 2;
let MIN_ANSWERS = 2;
let MAX_ANSWERS = 8;

// Question pools
let questionsData = null;
let roundQuestions = [];
let finalQuestions = [];
let usedQuestionIds = new Set();
let selectedQuestionFile = 'embedded';
let customQuestionsData = null;

// Final round state
let finalQIdx = 0;
let finalGuesses = [];

// Statistics
let stats = {
  questionsAnswered: 0,
  correctAnswers: 0,
  totalAnswerTime: 0,
  team1TopAnswers: 0,
  team2TopAnswers: 0
};

// Audio settings
let isMuted = false;
let masterVolume = 0.7;
let showStats = false;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  AUDIO SYSTEM                                                   ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx;
function ensureAudio() { if (!audioCtx) audioCtx = new AudioCtx(); }

function playCorrect() {
  if (isMuted) return;
  ensureAudio();
  const o = audioCtx.createOscillator(), g = audioCtx.createGain();
  o.connect(g); g.connect(audioCtx.destination);
  o.type = 'sine'; o.frequency.setValueAtTime(880, audioCtx.currentTime);
  o.frequency.setValueAtTime(1100, audioCtx.currentTime + 0.08);
  g.gain.setValueAtTime(0.35 * masterVolume, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
  o.start(); o.stop(audioCtx.currentTime + 0.3);
}

function playWrong() {
  if (isMuted) return;
  ensureAudio();
  const o = audioCtx.createOscillator(), g = audioCtx.createGain();
  o.connect(g); g.connect(audioCtx.destination);
  o.type = 'sawtooth'; o.frequency.setValueAtTime(200, audioCtx.currentTime);
  o.frequency.setValueAtTime(120, audioCtx.currentTime + 0.15);
  g.gain.setValueAtTime(0.3 * masterVolume, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.45);
  o.start(); o.stop(audioCtx.currentTime + 0.45);
}

function playTimerWarning() {
  if (isMuted) return;
  ensureAudio();
  const o = audioCtx.createOscillator(), g = audioCtx.createGain();
  o.connect(g); g.connect(audioCtx.destination);
  o.type = 'sine'; o.frequency.setValueAtTime(440, audioCtx.currentTime);
  g.gain.setValueAtTime(0.15 * masterVolume, audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.18);
  o.start(); o.stop(audioCtx.currentTime + 0.18);
}

function playNumberOne() {
  if (isMuted) return;
  ensureAudio();
  const now = audioCtx.currentTime;
  const notes = [523.25, 659.25, 783.99, 1046.50];
  notes.forEach((freq, i) => {
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.connect(g); g.connect(audioCtx.destination);
    o.type = 'sine';
    o.frequency.setValueAtTime(freq * 0.5, now);
    o.frequency.exponentialRampToValueAtTime(freq, now + 0.12);
    g.gain.setValueAtTime(0, now);
    g.gain.linearRampToValueAtTime((0.28 - i * 0.04) * masterVolume, now + 0.05);
    g.gain.setValueAtTime((0.28 - i * 0.04) * masterVolume, now + 0.4);
    g.gain.exponentialRampToValueAtTime(0.001, now + 1.2);
    o.start(now); o.stop(now + 1.3);
  });
  const notes2 = [659.25, 783.99, 987.77, 1318.50];
  notes2.forEach((freq, i) => {
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.connect(g); g.connect(audioCtx.destination);
    o.type = 'sine';
    o.frequency.setValueAtTime(freq, now + 0.3);
    g.gain.setValueAtTime(0, now + 0.3);
    g.gain.linearRampToValueAtTime((0.22 - i * 0.04) * masterVolume, now + 0.38);
    g.gain.exponentialRampToValueAtTime(0.001, now + 1.4);
    o.start(now + 0.3); o.stop(now + 1.5);
  });
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  VISUAL EFFECTS                                                 ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function flashCorrect() {
  const el = document.createElement('div');
  el.className = 'correct-flash';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 400);
}

function flashWrong() {
  const el = document.createElement('div');
  el.className = 'wrong-flash';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 450);
}

function showBigX() {
  const el = document.createElement('div');
  el.className = 'big-x';
  el.innerHTML = '<span>‚úï</span>';
  document.body.appendChild(el);
  setTimeout(() => el.remove(), 650);
}

function showNumberOneFlash() {
  const flash = document.createElement('div');
  flash.className = 'number-one-flash';
  flash.innerHTML = '<div class="n1-burst"></div><div class="n1-text">‚òÖ #1 ‚òÖ</div>';
  document.body.appendChild(flash);
  setTimeout(() => flash.remove(), 1700);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  UTILITY FUNCTIONS                                              ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function decodeHTMLEntities(text) {
  const textarea = document.createElement('textarea');
  textarea.innerHTML = text;
  return textarea.value;
}

function normalize(str) {
  return str.toLowerCase()
    .replace(/[√°√†√¢√§]/g, 'a').replace(/[√©√®√™√´]/g, 'e')
    .replace(/[√≠√¨√Æ√Ø]/g, 'i').replace(/[√≥√≤√¥√∂]/g, 'o')
    .replace(/[√∫√π√ª√º]/g, 'u').replace(/√±/g, 'n')
    .replace(/[^a-z0-9\s]/g, '').trim();
}

function fuzzyMatch(guess, target) {
  const g = normalize(guess);
  
  // Check against all variations (supports both old and new format)
  const variations = target.variations || [target.text];
  
  for (const variation of variations) {
    const t = normalize(variation);
    
    // Exact match
    if (g === t) return true;
    
    // Partial matching logic
    const gWords = g.split(/\s+/);
    const tWords = t.split(/\s+/);
    
    // Single word partial match (e.g., "pyram" matches "pyramids")
    if (gWords.length === 1 && tWords.length === 1) {
      if (g.length >= 4 && t.startsWith(g)) return true;
      if (t.length >= 4 && g.startsWith(t)) return true;
    }
    
    // Multi-word overlap match (e.g., "nile river" matches "the nile river")
    const overlap = gWords.filter(w => tWords.includes(w)).length;
    if (overlap > 0 && overlap >= Math.min(gWords.length, tWords.length) * 0.7) return true;
  }
  
  return false;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  QUESTION LOADING                                               ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function loadQuestions() {
  try {
    if (selectedQuestionFile === 'custom' && customQuestionsData) {
      questionsData = parseQuestionsJSON(customQuestionsData);
    } else {
      // Load questions from external allQuestions.json file
      const response = await fetch('allQuestions.json');
      if (!response.ok) {
        throw new Error(`Cannot load allQuestions.json (HTTP ${response.status}). Make sure the file is in the same folder as this HTML file.`);
      }
      const raw = await response.json();
      questionsData = parseQuestionsJSON(raw);
    }
    
    // Prepare question pools
    roundQuestions = shuffle(questionsData.rounds.filter(q => !usedQuestionIds.has(q.id)));
    finalQuestions = shuffle(questionsData.finalRound.filter(q => !usedQuestionIds.has(q.id)));
  } catch (error) {
    console.error('Error loading questions:', error);
    alert('‚ùå Error loading questions:\n\n' + error.message + '\n\nPlease upload a custom JSON file or make sure allQuestions.json is in the same folder.');
    throw error;
  }
}

function parseQuestionsJSON(raw) {
  const rounds = [];
  const finalRound = [];
  let id = 0;

  for (const [question, answersArray] of Object.entries(raw)) {
    // Skip if not valid
    if (!answersArray || !Array.isArray(answersArray) || answersArray.length < 2) {
      console.warn(`Skipping invalid question: "${question}"`, answersArray);
      continue;
    }
    
    // Parse answers with validation
    const answers = [];
    for (let i = 0; i < answersArray.length; i++) {
      const answerItem = answersArray[i];
      
      // Validate each answer is an array with [text, points] or [[variations], points]
      if (!Array.isArray(answerItem) || answerItem.length < 2) {
        console.warn(`Skipping invalid answer in "${question}":`, answerItem);
        continue;
      }
      
      const [textOrVariations, points] = answerItem;
      
      // Handle both formats:
      // Old format: ["Text", 50]
      // New format: [["Text", "text variation", "another way"], 50]
      let text, variations;
      
      if (Array.isArray(textOrVariations)) {
        // New format with variations
        if (textOrVariations.length === 0) {
          console.warn(`Skipping empty variations in "${question}":`, answerItem);
          continue;
        }
        text = textOrVariations[0]; // Display text is first variation
        variations = textOrVariations; // All variations for matching
      } else if (typeof textOrVariations === 'string') {
        // Old format with single text
        text = textOrVariations;
        variations = [textOrVariations];
      } else {
        console.warn(`Skipping malformed answer in "${question}":`, answerItem);
        continue;
      }
      
      // Validate points is number
      if (typeof points !== 'number') {
        console.warn(`Skipping answer with non-numeric points in "${question}":`, answerItem);
        continue;
      }
      
      answers.push({ text, variations, points });
    }
    
    // Only add question if answers are within the specified range
    if (answers.length >= MIN_ANSWERS && answers.length <= MAX_ANSWERS) {
      const questionObj = { id: id++, question, answers };
      rounds.push(questionObj);
      finalRound.push(questionObj);
    } else {
      console.warn(`Question "${question}" has ${answers.length} answers (outside range ${MIN_ANSWERS}-${MAX_ANSWERS}), skipping`);
    }
  }

  if (rounds.length === 0) {
    throw new Error(`No questions found with ${MIN_ANSWERS}-${MAX_ANSWERS} answers. Try adjusting the answer range in settings.`);
  }

  console.log(`Loaded ${rounds.length} questions (${MIN_ANSWERS}-${MAX_ANSWERS} answers each)`);
  return { rounds, finalRound };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  FILE UPLOAD HANDLING                                           ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function selectQuestionFile(type) {
  selectedQuestionFile = type;
  document.querySelectorAll('.file-option').forEach(el => el.classList.remove('selected'));
  if (type === 'embedded') {
    document.querySelector('.file-option').classList.add('selected');
  }
}

document.getElementById('uploadZone').addEventListener('click', () => {
  document.getElementById('fileInput').click();
});

document.getElementById('uploadZone').addEventListener('dragover', (e) => {
  e.preventDefault();
  e.currentTarget.classList.add('dragover');
});

document.getElementById('uploadZone').addEventListener('dragleave', (e) => {
  e.currentTarget.classList.remove('dragover');
});

document.getElementById('uploadZone').addEventListener('drop', (e) => {
  e.preventDefault();
  e.currentTarget.classList.remove('dragover');
  const file = e.dataTransfer.files[0];
  if (file) loadCustomFile(file);
});

document.getElementById('fileInput').addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (file) loadCustomFile(file);
});

function loadCustomFile(file) {
  if (!file.name.endsWith('.json')) {
    alert('Please upload a JSON file');
    return;
  }

  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      customQuestionsData = JSON.parse(e.target.result);
      
      // Add custom file option
      const selector = document.getElementById('fileSelector');
      const existingCustom = document.querySelector('.file-option[data-custom="true"]');
      if (existingCustom) existingCustom.remove();
      
      const customOption = document.createElement('div');
      customOption.className = 'file-option selected';
      customOption.setAttribute('data-custom', 'true');
      customOption.onclick = () => selectQuestionFile('custom');
      customOption.innerHTML = `
        <input type="radio" name="questionFile" value="custom" checked>
        <span class="file-option-label">üìÑ ${file.name}</span>
      `;
      selector.insertBefore(customOption, document.getElementById('uploadZone'));
      
      selectedQuestionFile = 'custom';
      document.querySelectorAll('.file-option').forEach(el => el.classList.remove('selected'));
      customOption.classList.add('selected');
      
    } catch (err) {
      alert('Error parsing JSON file: ' + err.message);
    }
  };
  reader.readAsText(file);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  GAME CONTROL                                                   ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function startGame() {
  // Load settings from UI
  NUM_ROUNDS = parseInt(document.getElementById('numRounds').value);
  QUESTIONS_PER_ROUND = parseInt(document.getElementById('questionsPerRound').value);
  TIMER_DURATION = parseInt(document.getElementById('timerDuration').value);
  MAX_STRIKES = parseInt(document.getElementById('maxStrikes').value);
  FINAL_MULTIPLIER = parseFloat(document.getElementById('finalMultiplier').value);
  MIN_ANSWERS = parseInt(document.getElementById('minAnswers').value);
  MAX_ANSWERS = parseInt(document.getElementById('maxAnswers').value);
  
  // Validate answer range
  if (MIN_ANSWERS > MAX_ANSWERS) {
    alert('‚ö†Ô∏è Minimum answers cannot be greater than maximum answers!');
    return;
  }

  // Load questions
  await loadQuestions();

  // Initialize game state
  scores = [0, 0];
  currentRound = 1;
  currentQIndex = 0;
  activeTeam = 0;
  usedQuestionIds.clear();
  stats = {
    questionsAnswered: 0,
    correctAnswers: 0,
    totalAnswerTime: 0,
    team1TopAnswers: 0,
    team2TopAnswers: 0
  };

  updateScoreUI();
  document.getElementById('startScreen').classList.add('hidden');
  showRoundTransition();
}

function showRoundTransition() {
  document.getElementById('roundTransition').classList.remove('hidden');
  document.getElementById('transitionTitle').textContent = 'Round ' + currentRound;
  document.getElementById('transitionSub').textContent =
    QUESTIONS_PER_ROUND + ' questions ‚Ä¢ ' + TIMER_DURATION + ' seconds each';
}

function beginRound() {
  document.getElementById('roundTransition').classList.add('hidden');
  document.getElementById('gameWrap').classList.remove('hidden');
  currentQIndex = 0;
  loadQuestion();
}

function loadQuestion() {
  if (currentQIndex >= QUESTIONS_PER_ROUND) {
    currentRound++;
    if (currentRound > NUM_ROUNDS) {
      startFinalRound();
    } else {
      showRoundTransition();
    }
    return;
  }

  const qIdx = (currentRound - 1) * QUESTIONS_PER_ROUND + currentQIndex;
  if (qIdx >= roundQuestions.length) {
    // Out of questions - reload pool
    roundQuestions = shuffle(questionsData.rounds.filter(q => !usedQuestionIds.has(q.id)));
    if (roundQuestions.length === 0) {
      alert('No more questions available!');
      return;
    }
  }

  currentQ = roundQuestions[qIdx];
  usedQuestionIds.add(currentQ.id);
  earnedSlots.clear();
  strikes = 0;
  gamePhase = 'playing';

  document.getElementById('questionText').textContent = decodeHTMLEntities(currentQ.question);
  document.getElementById('roundIndicator').textContent =
    'Round ' + currentRound + ' ‚Äî Question ' + (currentQIndex + 1);

  // Build answer grid
  const grid = document.getElementById('answerGrid');
  grid.innerHTML = '';
  currentQ.answers.forEach((a, i) => {
    grid.innerHTML += `
      <div class="answer-slot" id="slot${i}">
        <span class="slot-num">${i + 1}</span>
        <span class="slot-text">${a.text}</span>
        <span class="slot-points">${a.points}</span>
      </div>`;
  });

  // Build strikes
  const strikesRow = document.getElementById('strikesRow');
  strikesRow.innerHTML = '';
  for (let i = 0; i < MAX_STRIKES; i++) {
    strikesRow.innerHTML += `<div class="strike" id="strike${i}">‚úï</div>`;
  }

  updateAnswerCounter();
  startTimer();
  document.getElementById('answerInput').value = '';
  document.getElementById('answerInput').focus();
}

function updateAnswerCounter() {
  const revealed = earnedSlots.size;
  const total = currentQ.answers.length;
  document.getElementById('answerCounter').querySelector('.counter-value').textContent =
    revealed + ' / ' + total;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  TIMER                                                          ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startTimer() {
  stopTimer();
  timeLeft = TIMER_DURATION;
  const box = document.getElementById('timerBox');
  box.textContent = timeLeft;
  box.classList.remove('warning', 'danger');

  timerInterval = setInterval(() => {
    timeLeft--;
    box.textContent = timeLeft;

    if (timeLeft <= 5) {
      box.classList.add('danger');
      playTimerWarning();
    } else if (timeLeft <= 10) {
      box.classList.add('warning');
      box.classList.remove('danger');
    }

    if (timeLeft <= 0) {
      stopTimer();
      handleTimeout();
    }
  }, 1000);
}

function stopTimer() {
  if (timerInterval) {
    clearInterval(timerInterval);
    timerInterval = null;
  }
}

function handleTimeout() {
  if (gamePhase !== 'playing') return;
  gamePhase = 'idle';
  playWrong();
  flashWrong();
  pauseForNextQuestion(advanceQuestion);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  ANSWER SUBMISSION                                              ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function submitAnswer() {
  if (gamePhase !== 'playing') return;
  
  const input = document.getElementById('answerInput');
  const guess = input.value.trim();
  if (!guess) return;
  
  input.value = '';
  stats.questionsAnswered++;

  let found = false;
  for (let i = 0; i < currentQ.answers.length; i++) {
    if (earnedSlots.has(i)) continue;
    if (fuzzyMatch(guess, currentQ.answers[i])) {
      found = true;
      earnedSlots.add(i);
      scores[activeTeam] += currentQ.answers[i].points;
      document.getElementById('slot' + i).classList.add('revealed');
      playCorrect();
      flashCorrect();
      updateScoreUI();
      updateAnswerCounter();
      stats.correctAnswers++;
      stats.totalAnswerTime += (TIMER_DURATION - timeLeft);
      
      if (i === 0) {
        if (activeTeam === 0) stats.team1TopAnswers++;
        else stats.team2TopAnswers++;
      }
      
      if (earnedSlots.size === currentQ.answers.length) {
        stopTimer();
        gamePhase = 'idle';
        setTimeout(() => pauseForNextQuestion(advanceQuestion), 800);
      }
      break;
    }
  }

  if (!found) {
    strikes++;
    document.getElementById('strike' + (strikes - 1)).classList.add('active');
    playWrong();
    flashWrong();
    
    if (strikes >= MAX_STRIKES) {
      showBigX();
      stopTimer();
      gamePhase = 'idle';
      setTimeout(() => pauseForNextQuestion(advanceQuestion), 1200);
    }
  }

  updateStatsDisplay();
}

function skipQuestion() {
  if (gamePhase !== 'playing') return;
  stopTimer();
  gamePhase = 'idle';
  pauseForNextQuestion(advanceQuestion);
}

function showAllAnswers() {
  if (gamePhase !== 'playing') return;
  
  // Reveal all remaining answers
  for (let i = 0; i < currentQ.answers.length; i++) {
    document.getElementById('slot' + i).classList.add('revealed');
  }
  
  stopTimer();
  gamePhase = 'idle';
  setTimeout(() => pauseForNextQuestion(advanceQuestion), 1500);
}

function advanceQuestion() {
  currentQIndex++;
  activeTeam = 1 - activeTeam;
  updateScoreUI();
  loadQuestion();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  PAUSE OVERLAY                                                  ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function pauseForNextQuestion(advanceFn) {
  gamePhase = 'paused';
  pendingAdvance = advanceFn;

  const t1 = document.getElementById('team1Name').value || 'Team A';
  const t2 = document.getElementById('team2Name').value || 'Team B';
  let subtitle = '';

  if (advanceFn === advanceQuestion) {
    const nextIdx = currentQIndex + 1;
    if (nextIdx >= QUESTIONS_PER_ROUND) {
      subtitle = currentRound >= NUM_ROUNDS ? 'Final Round coming up!' : 'Round ' + (currentRound + 1) + ' next';
    } else {
      const nextTeam = activeTeam === 0 ? t2 : t1;
      subtitle = 'Question ' + (nextIdx + 1) + ' of ' + QUESTIONS_PER_ROUND + ' ‚Äî ' + nextTeam + '\'s turn';
    }
  } else {
    const nextFinal = finalQIdx + 1;
    subtitle = nextFinal >= 5 ? 'Game ending after this!' : 'Question ' + (nextFinal + 1) + ' of 5';
  }

  // Reveal all remaining slots
  const allSlots = document.querySelectorAll('.answer-slot');
  allSlots.forEach(slot => slot.classList.add('revealed'));

  // Build answers list
  const q = currentQ;
  const container = document.getElementById('revealedAnswers');
  container.innerHTML = '';
  if (q) {
    q.answers.forEach((a, i) => {
      const earnedClass = earnedSlots.has(i) ? 'earned' : 'missed';
      container.innerHTML += `<div class="reveal-pill ${earnedClass}">
        <span class="reveal-num">${i + 1}</span>
        <span class="reveal-text">${a.text}</span>
        <span class="reveal-pts">${a.points}</span>
      </div>`;
    });
  }

  document.getElementById('nextQTitle').textContent = 'Question Complete';
  document.getElementById('nextQSub').textContent = subtitle;
  document.getElementById('nextQOverlay').classList.remove('hidden');
}

function confirmNextQuestion() {
  document.getElementById('nextQOverlay').classList.add('hidden');
  if (pendingAdvance) {
    const fn = pendingAdvance;
    pendingAdvance = null;
    fn();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  FINAL ROUND                                                    ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startFinalRound() {
  document.getElementById('gameWrap').classList.add('hidden');
  document.getElementById('finalWrap').classList.remove('hidden');
  
  gamePhase = 'final';
  finalQIdx = 0;
  finalGuesses = [];
  
  // Pick 5 questions
  finalQuestions = shuffle(questionsData.finalRound.filter(q => !usedQuestionIds.has(q.id)));
  if (finalQuestions.length < 5) {
    finalQuestions = shuffle(questionsData.finalRound);
  }
  finalQuestions = finalQuestions.slice(0, 5);
  finalQuestions.forEach(q => usedQuestionIds.add(q.id));
  
  document.getElementById('fcell0').classList.add('active');
  loadFinalQuestion();
}

function loadFinalQuestion() {
  if (finalQIdx >= 5) {
    while (finalGuesses.length < 5) finalGuesses.push('');
    startReveal();
    return;
  }
  
  const q = finalQuestions[finalQIdx];
  document.getElementById('finalQuestionText').textContent = decodeHTMLEntities(q.question);
  document.getElementById('finalAnswerInput').value = '';
  document.getElementById('finalAnswerInput').focus();
  
  // Start timer for final round (15 seconds per question)
  stopTimer();
  timeLeft = 15;
  const box = document.getElementById('finalTimerBox');
  box.textContent = timeLeft;
  box.classList.remove('warning', 'danger');
  
  timerInterval = setInterval(() => {
    timeLeft--;
    box.textContent = timeLeft;
    
    if (timeLeft <= 3) {
      box.classList.add('danger');
      playTimerWarning();
    } else if (timeLeft <= 7) {
      box.classList.add('warning');
    }
    
    if (timeLeft <= 0) {
      stopTimer();
      finalSkip();
    }
  }, 1000);
}

function finalSubmit() {
  if (gamePhase !== 'final') return;
  const input = document.getElementById('finalAnswerInput');
  const guess = input.value.trim();
  if (!guess) return;
  input.value = '';
  
  finalGuesses.push(guess);
  document.getElementById('finalEchoText').textContent = guess;
  
  advanceFinalQuestion();
}

function finalSkip() {
  if (gamePhase !== 'final') return;
  finalGuesses.push('');
  document.getElementById('finalEchoText').textContent = '(passed)';
  advanceFinalQuestion();
}

function advanceFinalQuestion() {
  document.getElementById('fcell' + finalQIdx).classList.remove('active');
  document.getElementById('fcell' + finalQIdx).classList.add('done');
  
  finalQIdx++;
  if (finalQIdx >= 5) {
    gamePhase = 'idle';
    stopTimer();
    setTimeout(() => startReveal(), 800);
  } else {
    document.getElementById('fcell' + finalQIdx).classList.add('active');
    loadFinalQuestion();
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  REVEAL PHASE                                                   ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startReveal() {
  gamePhase = 'reveal';
  document.getElementById('finalWrap').classList.add('hidden');
  const overlay = document.getElementById('finalRevealOverlay');
  overlay.classList.remove('hidden');
  
  const container = document.getElementById('revealRows');
  container.innerHTML = '';
  for (let i = 0; i < 5; i++) {
    const q = finalQuestions[i];
    const guess = finalGuesses[i] || '(passed)';
    const decodedQuestion = decodeHTMLEntities(q.question);
    container.innerHTML += `
      <div class="reveal-row" id="rrow${i}">
        <div class="rr-num">${i + 1}</div>
        <div class="rr-body">
          <div class="rr-question">${decodedQuestion}</div>
          <div class="rr-answers">
            <span class="rr-guess">You: "${guess}"</span>
            <span class="rr-correct" id="rr-correct${i}"></span>
          </div>
        </div>
        <div class="rr-pts" id="rr-pts${i}"></div>
      </div>`;
  }
  
  document.getElementById('revealTotal').textContent = '0';
  document.getElementById('revealTotal').classList.remove('positive');
  document.getElementById('revealDoneBtn').classList.add('hidden');
  
  revealStep(0, 0);
}

function revealStep(idx, runningTotal) {
  if (idx >= 5) {
    document.getElementById('revealTotal').textContent = runningTotal;
    if (runningTotal > 0) document.getElementById('revealTotal').classList.add('positive');
    setTimeout(() => document.getElementById('revealDoneBtn').classList.remove('hidden'), 600);
    return;
  }
  
  const q = finalQuestions[idx];
  const guess = finalGuesses[idx] || '';
  const row = document.getElementById('rrow' + idx);
  
  // Check if guess matches ANY answer (not just #1)
  let matchedAnswer = null;
  if (guess) {
    for (const answer of q.answers) {
      if (fuzzyMatch(guess, answer)) {
        matchedAnswer = answer;
        break;
      }
    }
  }
  
  const isHit = matchedAnswer !== null;
  const displayAnswer = matchedAnswer || q.answers[0]; // Show what they got, or show #1 if wrong
  
  row.classList.add('active');
  
  setTimeout(() => {
    // Show the answer they matched (or #1 if they missed)
    const correctAnswerElem = document.getElementById('rr-correct' + idx);
    
    if (isHit && matchedAnswer !== q.answers[0]) {
      // They got a correct answer, but not #1 - show which one
      const answerRank = q.answers.indexOf(matchedAnswer) + 1;
      correctAnswerElem.textContent = `‚úì ${displayAnswer.text} (#${answerRank})`;
    } else {
      correctAnswerElem.textContent = displayAnswer.text;
    }
    
    const points = Math.round(displayAnswer.points * FINAL_MULTIPLIER);
    document.getElementById('rr-pts' + idx).textContent = points;
    
    if (isHit) {
      row.classList.remove('active');
      row.classList.add('hit');
      runningTotal += points;
      document.getElementById('revealTotal').textContent = runningTotal;
      document.getElementById('revealTotal').classList.add('positive');
      
      // Only play #1 celebration if they got the #1 answer
      if (matchedAnswer === q.answers[0]) {
        playNumberOne();
        showNumberOneFlash();
      } else {
        playCorrect();
      }
    } else {
      row.classList.remove('active');
      row.classList.add('miss');
      playWrong();
    }
    
    setTimeout(() => revealStep(idx + 1, runningTotal), 2200);
  }, 900);
}

function revealDone() {
  let earned = 0;
  for (let i = 0; i < 5; i++) {
    const q = finalQuestions[i];
    const guess = finalGuesses[i] || '';
    
    // Check if guess matches ANY answer (not just #1)
    if (guess) {
      for (const answer of q.answers) {
        if (fuzzyMatch(guess, answer)) {
          earned += Math.round(answer.points * FINAL_MULTIPLIER);
          break; // Only count once per question
        }
      }
    }
  }
  scores[activeTeam] += earned;
  updateScoreUI();
  
  document.getElementById('finalRevealOverlay').classList.add('hidden');
  gamePhase = 'idle';
  setTimeout(() => endGame(), 600);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  GAME END                                                       ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function endGame() {
  stopTimer();
  gamePhase = 'over';
  document.getElementById('finalWrap').classList.add('hidden');
  
  const t1 = document.getElementById('team1Name').value || 'Team A';
  const t2 = document.getElementById('team2Name').value || 'Team B';
  const w = scores[0] >= scores[1] ? 0 : 1;
  
  document.getElementById('finalScores').innerHTML = `
    <div class="final-score-card ${w===0?'winner':''}">
      ${w===0?'<div class="fs-crown">üëë</div>':''}
      <div class="fs-name">${t1}</div><div class="fs-val">${scores[0]}</div>
    </div>
    <div class="final-score-card ${w===1?'winner':''}">
      ${w===1?'<div class="fs-crown">üëë</div>':''}
      <div class="fs-name">${t2}</div><div class="fs-val">${scores[1]}</div>
    </div>`;
  
  // Show detailed statistics
  const accuracy = stats.questionsAnswered > 0 
    ? Math.round((stats.correctAnswers / stats.questionsAnswered) * 100)
    : 0;
  const avgTime = stats.correctAnswers > 0
    ? Math.round(stats.totalAnswerTime / stats.correctAnswers)
    : 0;
  
  document.getElementById('gameStats').innerHTML = `
    <div class="settings-panel">
      <div class="settings-section">
        <h3>üìä Game Statistics</h3>
        <div class="stat-row">
          <span class="stat-label">Total Questions:</span>
          <span class="stat-value">${stats.questionsAnswered}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Correct Answers:</span>
          <span class="stat-value">${stats.correctAnswers}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Accuracy:</span>
          <span class="stat-value">${accuracy}%</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">Avg Time/Answer:</span>
          <span class="stat-value">${avgTime}s</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">${t1} #1 Answers:</span>
          <span class="stat-value">${stats.team1TopAnswers}</span>
        </div>
        <div class="stat-row">
          <span class="stat-label">${t2} #1 Answers:</span>
          <span class="stat-value">${stats.team2TopAnswers}</span>
        </div>
      </div>
    </div>`;
  
  document.getElementById('gameOverScreen').classList.remove('hidden');
}

function restartGame() {
  document.getElementById('gameOverScreen').classList.add('hidden');
  document.getElementById('finalWrap').classList.add('hidden');
  document.getElementById('gameWrap').classList.add('hidden');
  document.getElementById('startScreen').classList.remove('hidden');
  
  scores = [0, 0];
  currentRound = 1;
  currentQIndex = 0;
  activeTeam = 0;
  usedQuestionIds.clear();
  updateScoreUI();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  UI UPDATES                                                     ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function updateScoreUI() {
  document.getElementById('team1Score').textContent = scores[0];
  document.getElementById('team2Score').textContent = scores[1];
  document.getElementById('team1Card').classList.toggle('active', activeTeam === 0);
  document.getElementById('team2Card').classList.toggle('active', activeTeam === 1);
}

function selectTeam(teamNum) {
  activeTeam = teamNum - 1;
  updateScoreUI();
}

function updateStatsDisplay() {
  if (!showStats) return;
  
  const accuracy = stats.questionsAnswered > 0 
    ? Math.round((stats.correctAnswers / stats.questionsAnswered) * 100)
    : 0;
  const avgTime = stats.correctAnswers > 0
    ? Math.round(stats.totalAnswerTime / stats.correctAnswers)
    : 0;
  
  document.getElementById('statQuestionsAnswered').textContent = stats.questionsAnswered;
  document.getElementById('statCorrectAnswers').textContent = stats.correctAnswers;
  document.getElementById('statAccuracy').textContent = accuracy + '%';
  document.getElementById('statAvgTime').textContent = avgTime + 's';
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  CONTROL PANEL                                                  ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function toggleMute() {
  isMuted = !isMuted;
  const btn = document.getElementById('muteBtn');
  btn.textContent = isMuted ? 'üîá' : 'üîä';
  btn.classList.toggle('active', isMuted);
  
  const volumeControl = document.getElementById('volumeControl');
  if (!isMuted) {
    volumeControl.classList.remove('hidden');
  } else {
    volumeControl.classList.add('hidden');
  }
}

function toggleStats() {
  showStats = !showStats;
  const btn = document.getElementById('statsBtn');
  const overlay = document.getElementById('statsOverlay');
  
  btn.classList.toggle('active', showStats);
  overlay.classList.toggle('hidden', !showStats);
  
  if (showStats) {
    updateStatsDisplay();
  }
}

function updateVolume(value) {
  masterVolume = value / 100;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  KEYBOARD SHORTCUTS                                             ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
document.addEventListener('keydown', function(e) {
  if (e.key !== 'Enter') return;
  if (document.activeElement && document.activeElement.classList.contains('answer-input')) return;
  
  if (!document.getElementById('nextQOverlay').classList.contains('hidden')) {
    confirmNextQuestion();
    return;
  }
  if (!document.getElementById('roundTransition').classList.contains('hidden')) {
    beginRound();
    return;
  }
  if (!document.getElementById('revealDoneBtn').classList.contains('hidden')) {
    revealDone();
    return;
  }
  if (!document.getElementById('gameOverScreen').classList.contains('hidden')) {
    restartGame();
    return;
  }
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ‚ïë  INITIALIZATION                                                 ‚ïë
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Load settings from localStorage if available
const savedSettings = localStorage.getItem('familyFeudSettings');
if (savedSettings) {
  const settings = JSON.parse(savedSettings);
  document.getElementById('numRounds').value = settings.numRounds || 3;
  document.getElementById('questionsPerRound').value = settings.questionsPerRound || 2;
  document.getElementById('timerDuration').value = settings.timerDuration || 45;
  document.getElementById('maxStrikes').value = settings.maxStrikes || 3;
  document.getElementById('finalMultiplier').value = settings.finalMultiplier || 2;
  document.getElementById('minAnswers').value = settings.minAnswers || 2;
  document.getElementById('maxAnswers').value = settings.maxAnswers || 8;
}

// Save settings to localStorage when changed
['numRounds', 'questionsPerRound', 'timerDuration', 'maxStrikes', 'finalMultiplier', 'minAnswers', 'maxAnswers'].forEach(id => {
  document.getElementById(id).addEventListener('change', () => {
    const settings = {
      numRounds: document.getElementById('numRounds').value,
      questionsPerRound: document.getElementById('questionsPerRound').value,
      timerDuration: document.getElementById('timerDuration').value,
      maxStrikes: document.getElementById('maxStrikes').value,
      finalMultiplier: document.getElementById('finalMultiplier').value,
      minAnswers: document.getElementById('minAnswers').value,
      maxAnswers: document.getElementById('maxAnswers').value
    };
    localStorage.setItem('familyFeudSettings', JSON.stringify(settings));
  });
});
</script>
</body>
</html>
